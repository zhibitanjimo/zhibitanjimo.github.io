<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jigsaw Puzzle Game</title>
    <style>
        .orgin {
            width: 300px;
            height: 300px;
            /* Hide by default */
        }
        .orgin img {
            width: 100%;
        }

        ul.stage {
            margin: 0;
            padding: 0;
            list-style: none;
            background-color: rgb(240, 240, 240);
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            padding: 10px;
            position: relative;
        }
        ul.stage li {
            overflow: hidden;
            position: absolute;
            top: 0;
            left: 0;
            margin: 2px;
            transition: all 0.3s;
            border-radius: 5px;
        }
        ul.stage li.active {
            box-shadow: 0 0 8px 0 #ff0000;
        }
        ul.stage li img {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>
    <div class="orgin">
        <img src="./banner2.jpg" alt="" />
    </div>

    <button id="difficultyButton">选择难度</button>

    <ul class="stage" id="stage3x3" style="width: 300px; height: 300px;">
        <!-- 3x3 Puzzle pieces will be generated by JavaScript -->
    </ul>

    <ul class="stage" id="stage6x6" style="width: 600px; height: 600px;">
        <!-- 6x6 Puzzle pieces will be generated by JavaScript -->
    </ul>

    <ul class="stage" id="stage9x9" style="width: 900px; height: 900px;">
        <!-- 9x9 Puzzle pieces will be generated by JavaScript -->
    </ul>

    <script>
        function generatePuzzle(pieces, containerId) {
            var container = document.getElementById(containerId);
            container.innerHTML = ''; // Clear existing pieces
            var size = container.offsetWidth / Math.sqrt(pieces);
            for (var i = 0; i < pieces; i++) {
                var li = document.createElement('li');
                li.style.width = size + 'px';
                li.style.height = size + 'px';
                var img = document.createElement('img');
                img.src = './banner2.jpg';
                img.style.width = container.offsetWidth + 'px'; // Set the image width to the container's width
                img.style.height = container.offsetHeight + 'px'; // Set the image height to the container's height
                li.appendChild(img);
                container.appendChild(li);
            }
            initPuzzle(container, pieces);
        }

        function initPuzzle(container, pieces) {
            var lis = container.querySelectorAll("li");
            var arr = [];
            for (var i = 0; i < lis.length; i++) {
                arr.push(i);
            }
            arr.sort(() => Math.random() - 0.5);
            lis.forEach((li, index) => {
                li.dataset.o = index;
                li.dataset.c = arr[index];
                li.style.top = Math.floor(li.dataset.c / Math.sqrt(pieces)) * li.offsetHeight + "px";
                li.style.left = (li.dataset.c % Math.sqrt(pieces)) * li.offsetWidth + "px";
                var img = li.querySelector("img");
                img.style.top = Math.floor(index / Math.sqrt(pieces)) * -li.offsetHeight + "px";
                img.style.left = (index % Math.sqrt(pieces)) * -li.offsetWidth + "px";
            });
            attachClickEvents(container);
        }

        function attachClickEvents(container) {
            var clickedLis = [];
            container.onclick = function (event) {
                var target = event.target;
                if (target.tagName == "IMG") {
                    target = target.parentNode;
                }
                if (target.tagName === "LI") {
                    clickedLis.push(target);
                    target.classList.add("active");
                    if (clickedLis.length === 2) {
                        setTimeout(() => {
                            var tmp = clickedLis[0].dataset.c;
                            clickedLis[0].dataset.c = clickedLis[1].dataset.c;
                            clickedLis[1].dataset.c = tmp;
                            clickedLis.forEach((li) => {
                                li.style.top = Math.floor(li.dataset.c / Math.sqrt(li.parentNode.querySelectorAll("li").length)) * li.offsetHeight + "px";
                                li.style.left = (li.dataset.c % Math.sqrt(li.parentNode.querySelectorAll("li").length)) * li.offsetWidth + "px";
                                var img = li.querySelector("img");
                                img.style.top = Math.floor(li.dataset.o / Math.sqrt(li.parentNode.querySelectorAll("li").length)) * -li.offsetHeight + "px";
                                img.style.left = (li.dataset.o % Math.sqrt(li.parentNode.querySelectorAll("li").length)) * -li.offsetWidth + "px";
                            });
                            checkCompletion(container);
                            clickedLis[0].classList.remove("active");
                            clickedLis[1].classList.remove("active");
                            clickedLis = [];
                        }, 300);
                    }
                }
            };
        }

        function checkCompletion(container) {
            var lis = container.querySelectorAll("li");
            var isFinished = Array.prototype.slice.call(lis).every((li) => {
                return li.dataset.o == li.dataset.c;
            });
            if (isFinished) {
                alert("拼图完成");
            }
        }

        document.getElementById('difficultyButton').addEventListener('click', function() {
            var difficulty = prompt("请输入你的拼图难度 (3x3, 6x6, 9x9):");
            var stages = {
                '3x3': 'stage3x3',
                '6x6': 'stage6x6',
                '9x9': 'stage9x9'
            };
            for (var key in stages) {
                document.getElementById(stages[key]).style.display = 'none';
            }
            var containerId = stages[difficulty];
            if (containerId) {
                document.getElementById(containerId).style.display = 'block';
                generatePuzzle(difficulty === '3x3' ? 9 : (difficulty === '6x6' ? 36 : 81), containerId);
            } else {
                alert('输入不合法,请输入3x3,6x6,9x9.');
            }
        });
    </script>
</body>
</html>